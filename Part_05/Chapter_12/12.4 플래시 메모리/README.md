# 12.4 플래시 메모리

플래시 메모리에는 `NOR 플래시`와 `NAND 플래시`의 두 종류가 존재한다.

<br/>

### NAND 플래시

데이터 저장 장치에 주로 사용되는 변종으로, 반도체의 셀이 직렬으로 배열되어 있다.

<br/>

NAND 플래시로부터 읽기는 일반적으로 4킬로바이트 단위의 데이터의 전체 `페이지(page)`를 필요로 하는데,  
**이 전체 페이지를 NAND 플래시에서 메인 메모리로 읽어들여야 한다.**

<br/>

플래시 메모리로 한 페이지를 쓰는 데 보통 100마이크로초가 걸린다.

하지만 플래시 메모리의 페이지가 한 번 쓰이면 해당 페이지에 직접 덮어쓰기(overwrite)을 할 수 없고,  
대신에 **페이지를 지우고(erase) 이어서 다시 쓰기를 해야 한다.**

- `지움 블록(erase block)`이라고 불리는 페이지 그룹에 대해 지움 연산을 수행하며, 대략 2~5 밀리초 정도의 시간이 든다.
- 지움 블록의 크기는 일반적으로 256킬로바이트에서 1메가바이트에 이르며, 한 개의 지움 블록은 대략 128~256개의 페이지로 되어 있다.
- 보통 100,000~1,000,000회 정도로 플래시 페이지를 지울 수 있는 횟수가 제한되어 있다.

→ 이 기준에 도달하게 되면 저장 비트 내에 오류가 발생할 가능성이 있다.

<br/>

---

<br/>

플래시 메모리 시스템은 <b>논리적 페이지 주소를 물리적(실제) 페이지 주소에 매핑(mapping)</b>함으로써  
느린 지움 속도와 갱신 횟수 제한으로 인해 받는 영향을 최소화한다.

논리적 페이지를 수정하면 이미 지운 물리적 페이지에 다시 대응해야 하고, 나중에 기존 위치에 있는 데이터를 지워야 한다.

<br/>

> 각 물리적 페이지는 자신의 논리적 주소를 저장한 메모리의 작은 부분을 차지한다.

만약 논리적 주소를 다른 물리적 주소로 다시 대응하면, 원래의 물리적 주소는 삭제된 것으로 간주한다.

신속한 접근을 위해, 논리적 페이지의 `물리적 페이지 대응 정보(logical-to-physical mapping, L2P)`는  
메모리 내 `변환 테이블(translation table)`로 복제된다.

<br/>

---

<br/>

플래시 메모리는 다수의 삭제된 페이지를 포함하는 블록을 주기적으로 지운다.

- 그 블록 내에 있는 지우지 않은 페이지를 다른 블록에 복사한다. 이때 변환 테이블은 그러한 안 지운 페이지에 대한 정보를 갱신한다.
- 각 물리적 페이지는 주어진 갱신 횟수 범위 안에서만 갱신될 수 있다.
    - 여러 번 지워졌던 물리적 페이지에는 거의 갱신 되지 않은 데이터라는 의미로 “`cold data`”가 할당된다.
    - 많이 지워지지 않았던 페이지는 자주 갱신되는 데이터라는 의미로 “`hot data`”가 저장된다.

> 물리적 블록에 걸쳐서 골고루 지움 연산을 불포시키는 원리를 `평등화 작업(wear leveling)`이라고 부른다.

<br/>

---

<br/>

`플래시 변환 계층(flash translation layer)`이라고 부르는 소프트웨어 계층이 위의 모든 동작을 수행한다.
