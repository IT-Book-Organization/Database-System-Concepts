# 12.6 디스크 블록 접근

<br/>

데이터베이스 시스템은 대부분의 디스크 I/O를 담당하는 질의 처리 서브시스템과 함께 디스크 I/O에 대한 요청을 생성한다.

각 요청은 디스크의 `디스크 식별자`와 `논리 블록 번호`로 구성된다.

<br/>

---

<br/>

디스크 블록에 대한 일련의 요청은 `순차적 접근 유형` 또는 `임의 접근 유형`으로 분류한다.

- `순차적 접근 유형`에서 <b>연속적인 요청(successive request)</b>은 같은 트랙 혹은 인접한 트랙에 있는 연속적인 블록을 대상으로 한다.
- `임의 접근 유형`에서 연속적인 데이터의 요청은 디스크상의 임의 위치한 블록을 대상으로 한다.  
  이러한 각 요청은 탐색이 필요하므로 접근 시간이 길어지고 초당 임의 I/O 연산 수가 줄어들게 된다.

<br/>
<br/>

## 블록에 대한 접근 속도를 향상하기 위한 기법들

**접근 횟수를 최소화함으로써**, 특히 임의 접근 횟수를 최소화함으로써 블록에 대한 접근 속도를 향상하기 위한 많은 기법을 개발해왔다.

자기 디스크에 저장된 데이터에 대한 임의 접근 횟수를 줄이는 것은 성능에 매우 중요하다.

<br/>

### 버퍼링, Buffering

다음에 있을 요청을 충족하기 위해 **디스크로부터 읽는 블록을 메모리 버퍼 내에 임시로 저장**하는 기법이다.

<br/>

### 미리 읽기, Read-ahead

디스크 블록에 접근할 때, 블록에 대한 요청이 없더라도 **동일 트랙 내의 연속적인 블록을 일단 메모리 내의 버퍼로 읽어들이는** 기법이다.

- `순차적 접근`의 경우, 이러한 미리 읽기는 많은 블록이 요청되더라도 이미 메모리 내에 있게 되기 때문에  
  블록 읽기당 디스크 탐색과 회전 지연에 낭비되는 시간을 최소화할 수 있다.
- `임의 블록 접근`의 경우 미리 읽기는 크게 유용하지 않다.

<br/>

### 스케줄링, Scheduling

실린더에 있는 몇 개의 블록을 디스크에서 메인 메모리로 전송할 필요가 있다면 헤드 아래로 지나갈 순서대로 블록을 요청함으로써 접근 시간을 줄일 수 있다.

<br/>

`디스크 암 스케줄링(disk-arm-scheduling) 알고리즘`은 **처리할 수 있는 접근 수를 최대한 증가시키는 방식으로** 트랙 접근 순서를 정하려고 한다.

→ 일반적으로 사용되는 알고리즘 : `승강기 알고리즘(elevator algorithm)`

<br/>

`디스크 컨트롤러`는 디스크 블록의 구성, 디스크 판의 회전 위치, 그리고 디스크 암의 위치에 대해 상세히 알고 있다.

따라서 보통 디스크 컨트롤러가 성능을 향상하기 위해 읽기 요구의 순서를 재구성하는 일을 수행한다.

이러한 재정렬을 활성화하려면 `디스크 컨트롤러 인터페이스`에서 대기열에 여러 요청을 추가할 수 있어야 한다.

<br/>

### 파일 구성, File organization

블록 접근 시간을 줄이기 위해 데이터에 접근하고자 하는 방식에 가장 가까이 부합하는 방식으로 디스크의 블록을 조직할 수 있다.

<br/>

최신 디스크는 운영체제에서 정확한 블록 위치를 숨기지만 **서로 인접한 블록에 연속 번호를 부여하는** `논리적 블록 번호`를 사용한다.

연속되는 번호를 매긴 디스크 블록에 파일의 `연속 블록(consecutive block)`을 할당함으로써 운영체제는 파일을 순차적으로 저장할 수 있다.

<br/>

하나의 긴 연속 블록의 순차로 대용량 파일을 저장하면 디스크 블록 할당에 문제가 발생하는데,  
이를 해결하기 위해 운영체제는 한 번에 몇 개의 연속 블록, 즉 `확장영역(extent)`을 파일에 할당한다.

파일에 할당된 다른 확장영역은 디스크에서 서로 인접하지 않을 수 있으며,  
블록이 무작위로 할당된 경우 파일에 대한 순차 접근은 블록당 하나의 탐색 대신에 **확장영역당 하나의 탐색**이 필요하다.

→ 충분히 큰 확장영역을 사용하면 데이터 전송 비용과 관련된 탐색 비용을 최소화할 수 있다.

<br/>

시간이 지남에 따라 여러 개의 착은 추가(append)가 있는 순차 파일은 `단편화(fragmented)`될 수 있다.

단편화를 줄이기 위해 시스템은 디스크에 있는 데이터의 백업본을 만들어서 전체 디스크를 다시 저장할 수 있다.

일부 운영체제는 단편화를 줄이기 위해 디스크를 스캔하면서 블록을 이동시키는 유틸리티를 제공한다.

<br/>

---

<br/>

위와 같은 저수준의 최적화(low-level optimizations) 외에도,  
질의 처리 알고리즘을 더 현명하게 설계해서 더 높은 수준에서의 임의 접근을 최소화할 수 있는 최적화를 수행할 수 있다.
