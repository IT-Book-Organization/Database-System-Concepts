# 17.2 간단한 트랜잭션 모델

<br/>

트랜잭션은 두 가지 연산을 이용하여 데이터에 접근한다.

> `read(X)`  
> (1) 데이터 항목 X를 데이터베이스로부터 읽어서  
> (2) read 연산을 수행하는 트랜잭션의 메인 메모리 버퍼에 있는 X라는 변수에 저장한다.

> `write(X)`  
> write 연산을 수행하는 트랜잭션의 메인 메모리 버퍼에 있는 변수 X의 값을 데이터베이스의 데이터 항목 X에 저장한다.

<br/>

데이터 항목에 대한 변경이 메인 메모리에만 반영되었는지, 아니면 디스크에도 기록되었는지 판단하는 것이 중요하다.

실제 데이터베이스 시스템에서 write 연산에 의한 중간 갱신 결과를 즉시 디스크에 저장하지 않고,  
다른 곳에 임시로 저장했다가 나중에 디스크에 저장할 수도 있기 때문이다.

(이 절에서는 write 연산이 데이터베이스를 즉시 갱신한다고 가정한다.)

<br/>
<br/>

## e.g., Transaction to transfer $50 from account A to account B

트랜잭션은 다음과 같이 작성된다.

```
read(A)
A := A - 50
write(A)
read(B)
B := B + 50
write(B)
```

<br/>

### 일관성

- 일관성 요구 조건 : 계좌 A와 B의 잔액 합이 트랜잭션 수행이 끝난 후에도 변하지 않아야 한다.
- 각각의 트랜잭션에 대한 일관성을 보장하는 것은 트랜잭션을 작성하는 응용 프로그래머의 책임이다.

<br/>

### 원자성

<p align="center"><img width="770" alt="transaction" src="https://github.com/IT-Book-Organization/Database-System-Concepts/assets/86337233/b56a8a0d-4b35-4cb5-88aa-792ed2d9f296">

<br/>
<br/>

> `비일관성 상태, inconsistent state`  
> 데이터베이스 시스템에 실패가 발생하여 더 이상 실세계의 실제 상태를 반영하지 못하게 된 상태

→ **트랜잭션이 시작되지 않았다거나, 아니면 완료되었다는 것을 보장할 수만 있다면**  
비일관성 상태는 트랜잭션을 실행하는 동안을 제외하고는 나타나지 않는다.

<br/>

#### 원자성을 보장하기 위한 기본 방법

1. 데이터베이스 시스템은 트랜잭션이 write 연산을 하는 데이터의 예전 값을 게속 추적하고, 이 정보는 `로그(log)`라고 불리는 파일에 기록된다.
2. 트랜잭션이 정상적으로 종료하지 못하면 데이터베이스 시스템은 **로그를 사용해 데이터의 이전 값으로 복구한다.**  
   이로써 마치 트랜잭션이 전혀 실행되지 않았던 것처럼 보이게 한다.

<br/>

### 지속성

- 지속성 요구 조건 : 트랜잭션이 성공적으로 종료된 이후에는 시스템 오류가 발생하더라도  
  그 트랜잭션이 처리한 모든 갱신 결과가 데이터베이스에 지속되어야 한다.
- 다음 둘 중 한가지를 지키면 지속성을 보장할 수 있다.
    1. 트랜잭션이 수행한 갱신을 트랜잭션이 완료되기 전에 디스크에 기록한다.
    2. 데이터베이스 시스템이 시스템 오류 후에 재시작되었을 때,  
       실패한 트랜잭션이 갱신한 데이터를 다시 복구할 수 있을 만큼 충분한 정보를 디스크에 기록한다.

<br/>

> `복구 시스템(recovery system)`이 원자성과 지속성을 보장하는 역할을 한다. (19장에서 설명)

<br/>

### 고립성

- 고립성 요구 조건 : 트랜잭션의 동시 실행 결과가 트랜잭션을 한 번에 하나씩 순차적으로 실행해서 얻은 결과와 같다는 것을 보장해야 한다.
    - 여러 트랜잭션이 동시에 수행되면 **그 트랜잭션을 구성하는 연산이 예기치 않은 순서로 배치되고**,
      이에 따라 비일관성 상태가 발생할 수 있다.
    - 동시에 실행하는 트랜잭션으로 인한 문제를 피하기 위한 한 방법은 순차적으로 트랜잭션을 실행하는 것이나, 이는 상당한 성능 저하를 일으킨다.

<br/>

> 고립성은 `동시성 제어 시스템(concurrency-control system)`이라는 데이터베이스 시스템의 구성요소가 책임지고 있다.
