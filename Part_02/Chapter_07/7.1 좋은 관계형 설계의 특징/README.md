# 7.1 좋은 관계형 설계의 특징

<br/>

예를 들어, 대학교 조직을 위한 데이터베이스를 설계할 대 in_dep 스키마로 시작했다고 가정하자.

이는 두 릴레이션 instructor와 department를 자연 조인(natural join)한 결과를 나타낸다.

```sql
in_dep
(ID, name, salary, dept_name, building, budget)
```

<br/>

이 방법은 더 적은 수의 조인을 이용하여 질의를 표현할 수 있으므로 좋은 방법처럼 보이지만,  
E-R 설계 대상인 대학교 조직에 대한 여러 사실을 생각해보면 그렇지 않다.

1. 학과 정보인 건물(building)과 예산(budget)을 학과 내의 각 교수에 대해서 **반복**해야 한다. (**중복성** 문제)


2. 같은 학과 교수에 대한 튜플이 동일한 예산 액수를 가져야 한다.
    - 그렇지 않으면 데이터베이스가 **일관성**을 잃게 된다.


3. 대학교 내에 새로운 학과를 하나 만든다고 하면,  
   학과에 교수가 적어도 한 명 이상 존재하지 않는다면 학과의 (dept_name, building, budget)에 관한 정보를 직접적으로 나타낼 수 없다.
    - 즉, building과 budget에 대해서 널 값을 가지는 튜플을 생성해야 한다.

<br/>
<br/>

## 7.1.1 분해

in_dep 스키마에서 정보의 반복 문제를 방지하는 유일한 방법은 두 개의 스키마(instructor와 department 스키마)로 `분해(decomposition)`하는 것이다.

<br/>

> 일반적으로 **정보의 반복이 나타나는 스키마를 여러 개의 작은 스키마로 분해한다**고 기억하자.

<br/>

### 손실 분해

> 하지만 스키마를 분해하는 것이 항상 도움이 되는 것은 아니다.

<br/>

예를 들어, 아래의 employee 스키마를 분해하기로 결정했다고 해보자.

```sql
employee
(ID, name, street, city, salary)
```

이는 다음과 같은 두 스키마로 분해할 수 있다.

```sql
employee1
(ID, name)
employee2(name, street, city, salary)
```

이 분해의 문제점은 이 조직에 동명이인이 있을 때 발생한다.

<br/>

아래 그림은 두 튜플, 분해한 두 스키마가 포함하는 튜플, 분해한 두 스키마에 자연 조인을 적용하여 원래의 튜플을 생성했을 때의 결과를 보여준다.

<p align="center"><img width="580" alt="손실 분해" src="https://user-images.githubusercontent.com/86337233/224742328-83d51027-e7ea-4a71-a878-a96375a4cd9d.png">

<br/>
<br/>

최종 결과는 Kim이라는 이름을 가진 본래의 두 튜플과 이 튜플에 속한 값을 잘못 혼합한 새로운 두 튜플을 추가로 포함하고 있는 것을 알 수 있다.

**분해 스키마를 자연 조인한 결과가 더 많은 튜플을 가지고 있음에도 불구하고,**  
어떤 도로, 도시, 급여가 Kim이라는 이름을 가진 누군가에게 속함은 파악할 수 있으나 두 Kim 중에 누구에게 속하는지는 구별할 수 없기 때문에 **실제로는 정보를 덜 가지고 있다.**

따라서 위의 분해는 대학교 지원에 대한 어떤 중요한 사실을 표현할 수 없다.

<br/>

이러한 분해를 `손실 분해(lossy decomposition)`이라고 부르며, 이처럼 중요한 사실을 다 표현하지 못하는 분해를 피해야 한다.

<br/>
<br/>

## 7.1.2 무손실 분해

R를 관계 스키마라 하고, R1과 R2는 R의 분해라고 하자.

즉, R, R1, R2는 속성의 집합이고, **R= R1 ⋃ R2로 분해하여 대체할 때 정보 손실이 없다면** 그 분해는 `무손실 분해(lossless decomposition)`라고 한다.

<br/>

릴레이션 r(R)의 인스턴스 대신 r1(R1)과 r2(R2)의 인스턴스를 사용해야만 하는데,  
이때 **r1(R1)과 r2(R2)의 인스턴스가 표현할 수 없는 정보를 r(R) 인스턴스가 가지고 있는 경우 정보의 손실이 발생한다.**

<br/>

> 모든 적법한(legal, 7.2.2절에서 정의함) 데이터베이스 인스턴스에 대해서  
> 릴레이션 r이 다음 SQL 질의의 결과와 동일한 튜플의 집합을 포함하는 경우 무손실 분해라고 한다.

```sql
select *
from (select R1 from r)
         natural join (select R2 from r)
```

<br/>

즉, 릴레이션 r에 대해 R1, R2를 각각 추출(project)하고, 이 추출 결과에 대해 자연 조인을 계산하면 다시 정확히 r를 얻는다.

반대로, 추출 결과의 자연 조인을 계산할 때 원래 릴레이션의 적절한 확대 집합(superset)을 얻는다면 이 분해는 손실 분해다.

<br/>
<br/>

## 7.1.3 정규화 이론

관계형 데이터베이스를 설계하는 방법은 일반적으로 `정규화(normalization)`로 알려진 절차를 따르는 것이다.

> 목표는 **불필요한 중복 없이 정보를 저장하고 쉽게 검색할 수 있도록** 릴레이션 스키마의 집합을 생성하는 것이다.

<br/>

### 접근 방식

- 주어진 릴레이션 스키마가 ‘좋은 형식’인지 결정한다. (7.3절에서 다룸, 다양한 형식(`정규형`)이 존재함)
- 주어진 릴레이션 스키마가 ‘좋은 형식’이 아닌 경우, 이를 여러 개의 더 작은 릴레이션 스키마로 분해하여, 각 릴레이션 스키마는 적절한 정규형이 되도록 한다.
    - 이때 적용한 분해는 **무손실 분해**여야 한다.
